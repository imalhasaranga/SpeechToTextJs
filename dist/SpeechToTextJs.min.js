function _commonPrefix(a,b){if(!a||!b)return"";for(var c="",d=0;d<a.length;d++){var e=a.charAt(d),f=b.charAt(d);e==f&&(c+=e)}return c}var SpeechToText=function(a,b){this.defLang="en",this.maxAlternatives=20,this.isContinuous=!0,this.allowInterimResults=!1,this.lastTranscript="",this.recognition=null,this.finalTranscript=null,this.error=b,this.success=a,this.onresult=null,this.onerror=null,this.onEndFunction=null,window.SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition;var c=this;setTimeout(function(){c.recognition=new window.SpeechRecognition,c.recognition.onresult=function(a){var b=a.results[a.resultIndex];c.onresult&&c.onresult(a),c._createString(b,a.resultIndex)},c.recognition.onerror=function(a){c.onerror&&c.onerror(a)},c.isSupported()?c.success&&c.success():c.error&&c.error()})};SpeechToText.prototype.isSupported=function(){return null!=window.SpeechRecognition},SpeechToText.prototype.onResult=function(a){this.onresult=a},SpeechToText.prototype.onError=function(a){this.onerror=a},SpeechToText.prototype.start=function(){this.finalTranscript=null,this.recognition.lang=this.defLang,this.recognition.continuous=this.isContinuous,this.recognition.interimResults=this.allowInterimResults,this.recognition.maxAlternatives=this.maxAlternatives,this.recognition.start()},SpeechToText.prototype.stop=function(a){this.recognition.stop(),this.onEndFunction=a},SpeechToText.prototype.clearText=function(){this.finalTranscript=""},SpeechToText.prototype.getText=function(){return this.finalTranscript},SpeechToText.prototype.setIsContinous=function(a){this.isContinuous=a},SpeechToText.prototype.setAllowInterimResults=function(a){this.interimResults=a},SpeechToText.prototype.setMaxAlternatives=function(a){this.maxAlternatives=a},SpeechToText.prototype.setLanguage=function(a){this.defLang=a},SpeechToText.prototype.getAllSupportedLanguages=function(){return[{key:"en",value:"English"},{key:"fr",value:"Français"},{key:"de",value:"Deutsch"},{key:"ja",value:"日本語"},{key:"zh-cn",value:"中文"},{key:"ru",value:"русский"},{key:"he",value:"עברית"}]},SpeechToText.prototype._createString=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(0==c)var e=_commonPrefix(d.transcript,this.lastTranscript);else{var e="";this.lastTranscript=""}}var f=e?""+e+d.transcript.replace(e,""):d.transcript;this.lastTranscript=d.transcript,this.finalTranscript=f,this.onEndFunction()};